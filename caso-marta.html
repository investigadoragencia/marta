<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Testar localização — clique para obter</title>
  <style>
    body { font-family: Inter, system-ui, Arial; padding: 20px; max-width:720px; margin:auto; }
    a.button {
      display:inline-block; padding:10px 16px; background:#0b74de; color:white; border-radius:8px;
      text-decoration:none; font-weight:600;
    }
    #status { margin-top:12px; color:#333; }
    #coords { margin-top:8px; font-family:monospace; background:#f6f8fb; padding:8px; border-radius:6px; }
  </style>
</head>
<body>
  <h2>Testar localização — clique só quando quiser</h2>

  <!-- Link que dispara a captura da localização -->
  <a href="#" id="getLocation" class="button">Obter minha localização</a>

  <div id="status"></div>
  <div id="coords" style="display:none"></div>

  <script>
    const btn = document.getElementById('getLocation');
    const status = document.getElementById('status');
    const coordsBox = document.getElementById('coords');

    // Opções para getCurrentPosition
    const geoOptions = {
      enableHighAccuracy: true, // pedirá GPS quando possível
      timeout: 10000,           // 10s
      maximumAge: 0
    };

    btn.addEventListener('click', async (ev) => {
      ev.preventDefault();
      status.textContent = 'Solicitando permissão de localização...';
      coordsBox.style.display = 'none';
      coordsBox.textContent = '';

      if (!('geolocation' in navigator)) {
        status.textContent = 'Navegador não suporta Geolocation API.';
        return;
      }

      // Pede a posição apenas ao clicar
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const acc = position.coords.accuracy; // metros
          const time = new Date(position.timestamp).toLocaleString();

          status.textContent = 'Localização obtida com sucesso.';
          coordsBox.style.display = 'block';
          coordsBox.innerHTML = `
            Latitude: ${lat}<br>
            Longitude: ${lon}<br>
            Precisão: ~${Math.round(acc)} m<br>
            Hora: ${time}
            <br><br>
            <a id="openMap" href="https://www.google.com/maps/search/?api=1&query=${lat},${lon}" target="_blank" rel="noopener noreferrer">Abrir no Google Maps</a>
            &nbsp;|&nbsp;
            <a id="openOsm" href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=18/${lat}/${lon}" target="_blank" rel="noopener noreferrer">Abrir no OSM</a>
          `;
        },
        (err) => {
          switch(err.code) {
            case err.PERMISSION_DENIED:
              status.textContent = 'Permissão negada pelo usuário.';
              break;
            case err.POSITION_UNAVAILABLE:
              status.textContent = 'Localização indisponível.';
              break;
            case err.TIMEOUT:
              status.textContent = 'Tempo esgotado ao obter localização.';
              break;
            default:
              status.textContent = 'Erro ao obter localização: ' + err.message;
          }
        },
        geoOptions
      );
    });
  </script>
</body>
</html>
